<div class="main-wrapper">

  <div class="left-menu">
    <h3>ОНОВИТИ</h3>
    <form #form="ngForm" (ngSubmit)="updateGroup()">
      <mat-form-field>
        <mat-label>Місто</mat-label>
        <input
          type="text"
          name="cityId"
          [value]="group?.city?.name"
          matInput
          disabled
        >
      </mat-form-field>
      <mat-form-field>
        <mat-label>Курс</mat-label>
        <input
          type="text"
          name="courseId"
          [value]="group.course?.name"
          matInput
          disabled
        >
      </mat-form-field>
      <mat-form-field>
        <mat-label>Ім'я</mat-label>
        <input
          type="text"
          name="name"
          [(ngModel)]="group.name"
          matInput
          required
        >
      </mat-form-field>
      <mat-form-field>
        <mat-label>Вільна практика</mat-label>
        <input
          type="number"
          name="freePractice"
          [(ngModel)]="group.freePractice"
          #freePractice="ngModel"
          (input)="validatePractice(freePractice)"
          matInput
          required
        >
      </mat-form-field>
      <mat-form-field>
        <mat-label>Використана практика</mat-label>
        <input
          type="number"
          name="usedPractice"
          [(ngModel)]="group.usedPractice"
          matInput
          disabled
        >
      </mat-form-field>
      <mat-form-field>
        <mat-label>Початкова дата</mat-label>
        <input
          type="text"
          matInput
          [(ngModel)]="group.startDate"
          name="startDate"
          [matDatepicker]="pickerStartDate"
          placeholder="Виберіть дату"
          readonly
          (click)="pickerStartDate.open()"
        >
        <mat-datepicker-toggle matSuffix [for]="pickerStartDate"></mat-datepicker-toggle>
        <mat-datepicker #pickerStartDate disabled="false"></mat-datepicker>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Початковий час</mat-label>
        <input
          type="time"
          name="startTime"
          [(ngModel)]="group.startTime"
          required
          matInput
        >
      </mat-form-field>
      <mat-form-field>
        <mat-label>Дата закінчення</mat-label>
        <input
          type="text"
          matInput
          [(ngModel)]="group.expirationDate"
          name="expirationDate"
          readonly
          placeholder="Дата закінчення"
          [matDatepicker]="pickerEndDate"
          (click)="pickerEndDate.open()">
        <mat-datepicker-toggle matSuffix [for]="pickerEndDate"></mat-datepicker-toggle>
        <mat-datepicker #pickerEndDate disabled="false"></mat-datepicker>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Викладач</mat-label>
        <input
          type="text"
          name="teacher"
          [(ngModel)]="group.teacher"
          matInput
        >
      </mat-form-field>

      <button *ngIf="canUpdateGroup" mat-flat-button [disabled]="!form.valid">Оновити</button>
    </form>
  </div>
  <div class="right-menu">
    <div class="right-menu-header">
      <div>
        <h3>СТАТИСТИКА ВІДВІДУВАНОСТІ</h3>
        <h3>Кількість учнів: {{studentsQuantity}}</h3>
      </div>
      <h3>Викладач: {{group.teacher}}</h3>
    </div>
    <div>
      <canvas
        *ngIf="chartDatasets.length > 0"
        baseChart
        chartType="bar"
        [labels]="chartLabels"
        [datasets]="chartDatasets"
        [legend]="false"
        [colors]="chartColors"
        [options]="chartOptions"
        width="100%"
        height="48%"
      >
      </canvas>
    </div>

    <div class="app-statistic" *ngIf="canSeeStatisticOfAppsFromAnotherGroups">
      <div class="head-app-statistic"><h3>УЧНІ З ЗАЯВКАМИ З ІНШИХ ГРУП: {{quantityClientsFromAnotherGroups}}</h3></div>
      <button *ngIf="!appStatisticAll" mat-flat-button [ngStyle]="{'width':'100%'}" (click)="showGroupAppStat()">Завантажити</button>
      <div class="group-app-all-frame"  *ngIf="appStatisticAll">
        <div *ngIf="quantityClientsFromAnotherGroups" class="app-from-another-group-bar"
             [ngStyle]="{'width': appFromThisAndAnotherGroupPercent}">
          {{quantityClientsFromAnotherGroups}}/{{appStatisticAll.applicationsByGroup.length}}
        </div>
      </div>
    </div>
    <div class="users-from-another-groups">

    </div>
  </div>


  <div class="group-lesson-block">
    <h3>ЗАНЯТТЯ</h3>
    <mat-expansion-panel *ngIf="canCreateLesson">
      <mat-expansion-panel-header>
        <mat-panel-title>
          СТВОРИТИ ЗАНЯТТЯ
        </mat-panel-title>
      </mat-expansion-panel-header>
      <form #formLesson="ngForm" (ngSubmit)="createLesson(formLesson)">
        <mat-form-field>
          <mat-label>Тема</mat-label>
          <input
            type="text"
            name="topic"
            ngModel
            matInput
            required
          >
        </mat-form-field>
        <mat-checkbox ngModel name="main" [value]="false">Ключове заняття</mat-checkbox>
        <button mat-flat-button [disabled]="!formLesson.valid">Створити</button>
      </form>
    </mat-expansion-panel>
    <app-lessons-table
      *ngIf="group.id"
      #lessonsTable
      [byGroupId]="group.id"
      [canDeleteLessonInput]="canDeleteLesson"
    ></app-lessons-table>
  </div>


  <div class="group-applications overflow-x" *ngIf="group.id">
    <h3>ЗАЯВКИ</h3>
    <app-applications-table *ngIf="group.id" [byGroupId]="group.id"
                            [canDeleteApplicationInput]="canDeleteApplication" #appApplctnTable></app-applications-table>
  </div>



  <div class="group-practice overflow-x">
    <h3>ПРАКТИКА</h3>
    <mat-selection-list #practiceList>
      <ng-container *ngFor="let app of applicationsToPractice">
        <mat-list-option [value]="app.id" [selected]="!!app.hasPractice"
                         [disabled]="(!canSelectPractice) || (!hasFreePracticePlaces && !app.hasPractice)">
          <mat-icon mat-list-icon (click)="openApplication(app.id, $event)">meeting_room</mat-icon>
          <p>{{app.client.name}} {{app.client.surname}}</p>
        </mat-list-option>
        <mat-divider></mat-divider>
      </ng-container>
    </mat-selection-list>
  </div>
</div>

<div class="applications-info" #applicationsInfo *ngIf="arrOfAnotherGroups">
  <h1>Заявки з інших груп:</h1>
  <div class="flex-r">
    <div *ngFor="let appAndGroup of arrOfAnotherGroups">
      <div *ngIf="appAndGroup" class="border-right">
        <h2>{{appAndGroup.name}}</h2>
        <span *ngIf="appAndGroup.applications">{{appAndGroup.applications.length}}</span>
        <!--<div *ngFor="let app of appAndGroup.applications">-->
        <!--</div>-->
      </div>
    </div>
  </div>
  <button
    mat-flat-button
    [ngStyle]="{'width':'100%', 'background':'white', 'color':'black', 'margin-top':'20px'}"
    (click)="showClientsFromAnotherGroups()"
  >
    Показати список учнів та груп
  </button>
</div>
<div class="modal-clients" #modalClients>
  <div class="modal-clients-info" *ngIf="arrOfAnotherGroupsAndClients">
    <div class="top-bamper"></div>
    <div class="table-modal-clients" [ngStyle]="{'width':'100%'}">
      <div *ngFor="let g of arrOfAnotherGroupsAndClients" [ngStyle]="{'margin-bottom':'20px'}">
      <table *ngIf="g">
        <tbody *ngIf="g" [ngStyle]="{'width':'100%', 'background':'white', 'color':'black'}">
          <tr>
            <th>Група</th>
            <th>Викладач</th>
            <th>Початок навчання</th>
            <th>Дата закінчення:</th>
            <th>Місто</th>
          </tr>
          <tr class="group-desc" [ngStyle]="{'background':'white', 'color':'black'}">
            <th>{{g.name}}</th>
            <th>{{g.teacher}}</th>
            <th>{{g.startDate}}</th>
            <th>{{g.expirationDate}}</th>
            <th>{{g.city.name}}</th>
          </tr>
          <tr>
            <th>Ім'я Призвіще</th>
            <th>Вік</th>
            <th>Email</th>
            <th>Телефон</th>
            <th>Статус</th>
          </tr>
            <tr *ngFor="let client of g.clients" (click)="open(client, 'clients', $event)">
              <td>{{client.name}} {{client.surname}}</td>
              <td>{{client.age}}</td>
              <td>{{client.email}}</td>
              <td>{{client.phone}}</td>
              <td [ngStyle]="{'background':client.status.color}">{{client.status.name}}</td>
            </tr>
        </tbody>
      </table>
      </div>
    </div>
    <div class="bottom-bamper"></div>
  </div>
  <div class="modal-clients-background">
  </div>
  <span class="close-modal-clients">X</span>
</div>
